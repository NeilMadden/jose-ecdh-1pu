<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Public Key Authenticated Encryption for JOSE: ECDH-1PU</title>
<meta content="Neil Madden" name="author">
<meta content="
       
                This document describes the ECDH-1PU public key authenticated encryption algorithm
                for JWE. The algorithm is similar to the existing ECDH-ES encryption algorithm, but
                adds an additional ECDH key agreement between static keys of the sender and recipient.
                This additional step allows the recipient to be assured of sender authenticity without
                requiring a nested signed-then-encrypted message structure. 
       
    " name="description">
<meta content="xml2rfc 3.7.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="JSON Object Signing and Encryption" name="keyword">
<meta content="JOSE" name="keyword">
<meta content="JSON Web Encryption" name="keyword">
<meta content="JWE" name="keyword">
<meta content="JSON Web Algorithms" name="keyword">
<meta content="JWA" name="keyword">
<meta content="Elliptic Curve Diffie-Hellman Key Agreement" name="keyword">
<meta content="ECDH" name="keyword">
<meta content="ECDH-1PU" name="keyword">
<meta content="draft-madden-jose-ecdh-1pu-04" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.7.0
    Python 3.9.2
    appdirs 1.4.4
    ConfigArgParse 1.4
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.25.1
    setuptools 49.2.1
    six 1.15.0
-->
<link href="draft-madden-jose-ecdh-1pu-04.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">JOSE ECDH-1PU</td>
<td class="right">May 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Madden</td>
<td class="center">Expires 6 November 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-madden-jose-ecdh-1pu-04</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-05-05" class="published">5 May 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-11-06">6 November 2021</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">N.E. Madden</div>
<div class="org">ForgeRock</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Public Key Authenticated Encryption for JOSE: ECDH-1PU</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
                This document describes the ECDH-1PU public key authenticated encryption algorithm
                for JWE. The algorithm is similar to the existing ECDH-ES encryption algorithm, but
                adds an additional ECDH key agreement between static keys of the sender and recipient.
                This additional step allows the recipient to be assured of sender authenticity without
                requiring a nested signed-then-encrypted message structure.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo-2">
<a href="#name-status-of-this-memo-2" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 6 November 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice-2">
<a href="#name-copyright-notice-2" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents-2">
<a href="#name-table-of-contents-2" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction-2" class="xref">Introduction</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-requirements-terminology-2" class="xref">Requirements Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-key-agreement-with-elliptic-" class="xref">Key Agreement with Elliptic Curve Diffie-Hellman One-Pass Unified Model (ECDH-1PU)</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-special-considerations-for-k" class="xref">Special Considerations for Key Agreement with Key Wrapping mode</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-header-parameters-used-for-e" class="xref">Header Parameters used for ECDH Key Agreement</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="xref">2.2.1</a>.  <a href="#name-skid-header-parameter-2" class="xref">"skid" Header Parameter</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-key-derivation-for-ecdh-1pu-" class="xref">Key Derivation for ECDH-1PU Key Agreement</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-iana-considerations-2" class="xref">IANA considerations</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-json-web-signature-and-encryp" class="xref">JSON Web Signature and Encryption Algorithms Registration</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="xref">3.1.1</a>.  <a href="#name-ecdh-1pu-2" class="xref">ECDH-1PU</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-json-web-signature-and-encrypt" class="xref">JSON Web Signature and Encryption Header Parameters Registration</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-skid-2" class="xref">skid</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-security-considerations-2" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-references-2" class="xref">References</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-normative-references-2" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-informative-references-2" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-example-ecdh-1pu-key-agreeme" class="xref">Example ECDH-1PU Key Agreement Computation with A256GCM</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-appendix.b" class="xref">Appendix B</a>.  <a href="#name-document-history-2" class="xref">Document History</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-appendix.c" class="xref"></a><a href="#name-authors-address-2" class="xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction-2">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction-2" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
                JSON Object Signing and Encryption (JOSE) defines a number of encryption (JWE) 
                <span>[<a href="#RFC7516" class="xref">RFC7516</a>]</span> and digital signature (JWS) <span>[<a href="#RFC7515" class="xref">RFC7515</a>]</span> 
                algorithms.  When symmetric cryptography is used, JWE provides authenticated
                encryption that ensures both confidentiality and sender authentication. However,
                for public key cryptography the existing JWE encryption algorithms provide only
                confidentiality and some level of ciphertext integrity. When sender authentication
                is required, users must resort to nested signed-then-encrypted structures, which
                increases the overhead and size of resulting messages. This document describes an
                alternative encryption algorithm called ECDH-1PU that provides public key
                authenticated encryption, allowing the benefits of authenticated encryption to be
                enjoyed for public key JWE as it currently is for symmetric cryptography.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
                ECDH-1PU is based on the One-Pass Unified Model for Elliptic Curve Diffie-Hellman
                key agreement described in <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">
                The advantages of public key authenticated encryption with ECDH-1PU compared to
                using nested signed-then-encrypted documents include the following:<a href="#section-1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-4.1">
                        The resulting message size is more compact as an additional layer of headers
                        and base64url-encoding is avoided. A 500-byte payload when encrypted and
                        authenticated with ECDH-1PU (with P-256 keys and "A256GCM" Content Encryption
                        Method) results in a 1087-byte JWE in Compact Encoding. An equivalent nested 
                        signed-then-encrypted JOSE message using the same keys and encryption method 
                        is 1489 bytes (37% larger).<a href="#section-1-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.2">
                        The same primitives are used for both confidentiality and authenticity,
                        providing savings in code size for constrained environments.<a href="#section-1-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.3">
                        The generic composition of signatures and public key encryption involves
                        a number of subtle details that are essential to security <span>[<a href="#PKAE" class="xref">PKAE</a>]</span>.
                        Providing a dedicated algorithm for public key authenticated encryption
                        reduces complexity for users of JOSE libraries.<a href="#section-1-4.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.4">
                        ECDH-1PU provides only authenticity and not the stronger security properties of
                        non-repudiation or third-party verifiability. This can be an advantage in
                        applications where privacy, anonymity, or plausible deniability are goals.<a href="#section-1-4.4" class="pilcrow">¶</a>
</li>
      </ul>
<section id="section-1.1">
        <h3 id="name-requirements-terminology-2">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-terminology-2" class="section-name selfRef">Requirements Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", 
                    "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", 
                    and "OPTIONAL" in this document are to be interpreted as described 
                    in BCP 14 <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear
                    in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="ecdh-1pu">
<section id="section-2">
      <h2 id="name-key-agreement-with-elliptic-">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-key-agreement-with-elliptic-" class="section-name selfRef">Key Agreement with Elliptic Curve Diffie-Hellman One-Pass Unified Model (ECDH-1PU)</a>
      </h2>
<p id="section-2-1">
                This section defines the specifics of key agreement with Elliptic Curve Diffie-Hellman
                One-Pass Unified Model, in combination with the one-step KDF, as defined in
                Section 5.8.2.1 of <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span> using the Concatenation Format of
                Section 5.8.2.1.1. This is identical to the ConcatKDF function used by the existing
                JWE ECDH-ES algorithm defined in Section 4.6 of <span>[<a href="#RFC7518" class="xref">RFC7518</a>]</span>. As for ECDH-ES,
                the key agreement result can be used in one of two ways:<a href="#section-2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2-2">
<li id="section-2-2.1">directly as the Content Encryption Key (CEK) for the "enc" algorithm, in the
                        Direct Key Agreement mode, or<a href="#section-2-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-2-2.2">as a symmetric key used to wrap the CEK with the "A128KW", "A192KW", or "A256KW"
                        algorithms, in the Key Agreement with Key Wrapping mode.<a href="#section-2-2.2" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-2-3">
                A fresh ephemeral public key value MUST be generated for each message. When encrypting
                the message to multiple recipients using ECDH-1PU, the same ephemeral keys MAY be reused
                for multiple recipients <span>[<a href="#MRES" class="xref">MRES</a>]</span>.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">
                In Direct Key Agreement mode, the output of the KDF MUST be a key of the same length
                as that used by the "enc" algorithm. In this case, the empty octet sequence is used
                as the JWE Encrypted Key value. The "alg" (algorithm) Header Parameter value "ECDH-1PU"
                is used in Direct Key Agreement mode.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">
                In Key Agreement with Key Wrapping mode, the output of the KDF MUST be a key of the length
                needed for the specified key wrapping algorithm. In this case, the JWE Encrypted Key is
                the CEK wrapped with the agreed-upon key.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">
                The following "alg" (algorithm) Header Parameter values are used to indicate the JWE
                Encrypted Key is the result of encrypting the CEK using the result of the key agreement
                algorithm as the key encryption key for the corresponding key wrapping algorithm:<a href="#section-2-6" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
        <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">"alg" Param Value</th>
            <th class="text-left" rowspan="1" colspan="1">Key Management Algorithm</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">ECDH-1PU+A128KW</td>
            <td class="text-left" rowspan="1" colspan="1">ECDH-1PU using one-pass KDF and CEK wrapped with "A128KW"</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">ECDH-1PU+A192KW</td>
            <td class="text-left" rowspan="1" colspan="1">ECDH-1PU using one-pass KDF and CEK wrapped with "A192KW"</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">ECDH-1PU+A256KW</td>
            <td class="text-left" rowspan="1" colspan="1">ECDH-1PU using one-pass KDF and CEK wrapped with "A256KW"</td>
          </tr>
        </tbody>
      </table>
<section id="section-2.1">
        <h3 id="name-special-considerations-for-k">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-special-considerations-for-k" class="section-name selfRef">Special Considerations for Key Agreement with Key Wrapping mode</a>
        </h3>
<p id="section-2.1-1">
                    In Key Agreement with Key Wrapping mode, the JWE Authentication Tag is included in the
                    input to the Key Derivation Function as described in section <a href="#kdf" class="xref">Section 2.3</a>. This
                    ensures that the content of the JWE was produced by the original sender and not by 
                    another recipient, as described in section <a href="#security" class="xref">Section 4</a>.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">
                    Key Agreement with Key Wrapping mode MUST only be used with content encryption algorithms
                    that are compactly committing AEADs as described in <span>[<a href="#ccAEAD" class="xref">ccAEAD</a>]</span>. The
                    AES_CBC_HMAC_SHA2 algorithms described in section 5.2 of <span>[<a href="#RFC7518" class="xref">RFC7518</a>]</span> are
                    compactly committing and can be used with ECDH-1PU in Key Agreement with Key Wrapping mode.
                    Other content encryption algorithms MUST be rejected. In Direct Key Agreement mode, any
                    JWE content encryption algorithm MAY be used.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">
                    The requirement to include the JWE Authentication Tag in the input to the Key Derivation
                    Function requires an adjustment to the order of operations performed during JWE Message
                    Encryption described in section 5.1 of <span>[<a href="#RFC7516" class="xref">RFC7516</a>]</span>. Steps 3-8 are deferred
                    until after step 15, using the randomly generated CEK from step 2 for encryption of the 
                    message content.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
</section>
<section id="section-2.2">
        <h3 id="name-header-parameters-used-for-e">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-header-parameters-used-for-e" class="section-name selfRef">Header Parameters used for ECDH Key Agreement</a>
        </h3>
<p id="section-2.2-1">
                    The "epk" (ephemeral public key), "apu" (Agreement PartyUInfo), and "apv" (Agreement PartyVInfo)
                    header parameters are used in ECDH-1PU exactly as defined in Section 4.6.1 of
                    <span>[<a href="#RFC7518" class="xref">RFC7518</a>]</span>.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">
                    When no other values are supplied, it is RECOMMENDED that the producer software
                    initializes the "apu" header to the base64url-encoding of the SHA-256 hash of the
                    concatenation of the sender's static public key and the ephemeral public key, and
                    the "apv" header to the base64url-encoding of the SHA-256 hash of the recipient's
                    static public key. This ensures that all keys involved in the key agreement are
                    cryptographically bound to the derived keys.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<div id="skid">
<section id="section-2.2.1">
          <h4 id="name-skid-header-parameter-2">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-skid-header-parameter-2" class="section-name selfRef">"skid" Header Parameter</a>
          </h4>
<p id="section-2.2.1-1">
                        A new Header Parameter "skid" (Sender Key ID) is registered as a hint as to which 
                        of the sender's keys was used to authenticate the JWE. The structure of the "skid"
                        value is unspecified. Its value MUST be a case-sensitive string. Use of this Header
                        Parameter is OPTIONAL. When used with a JWK, the "skid" value is used to match a JWK
                        "kid" parameter value <span>[<a href="#RFC7517" class="xref">RFC7517</a>]</span>.<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
<div id="kdf">
<section id="section-2.3">
        <h3 id="name-key-derivation-for-ecdh-1pu-">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-key-derivation-for-ecdh-1pu-" class="section-name selfRef">Key Derivation for ECDH-1PU Key Agreement</a>
        </h3>
<p id="section-2.3-1">
                    The key derivation process derives the agreed-upon key from the shared secret Z
                    established through the ECDH algorithm, per Section 6.2.1.2 of <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span>.
                    For the NIST prime order curves "P-256", "P-384", and "P-521", the ECC CDH primitive
                    for cofactor Diffie-Hellman defined in Section 5.7.1.2 of <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span> is
                    used (taking note that the cofactor for all these curves is 1). For curves "X25519" and
                    "X448" the appropriate ECDH primitive from Section 5 of <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span> is used.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">
                    Key derivation is performed using the one-step KDF, as defined in Section 5.8.1 and
                    Section 5.8.2.1 of <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span> using the Concatenation Format of
                    Section 5.8.2.1.1, where the Auxilary Function H is SHA-256. The KDF parameters
                    are set as follows:<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.3-3">
          <dt id="section-2.3-3.1">Z</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-3.2">
                            This is set to the representation of the shared secret Z as an octet sequence.
                            As per Section 6.2.1.2 of <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span> Z is the concatenation
                            of Ze and Zs, where Ze is the shared secret derived from applying the ECDH
                            primitive to the sender's ephemeral private key and the recipient's static
                            public key (when sending) or the recipient's static private key and the sender's
                            ephemeral public key (when receiving). Zs is the shared secret derived from 
                            applying the ECDH primitive to the sender's static private key and the recipient's 
                            static public key (when sending) or the recipient's static private key and the
                            sender's static public key (when receiving).<a href="#section-2.3-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-3.3">keydatalen</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-3.4">
                            This is set to the number of bits in the desired output key. For "ECDH-1PU",
                            this is the length of the key used by the "enc" algorithm. For "ECDH-1PU+A128KW",
                            "ECDH-1PU+A192KW", and "ECDH-1PU+A256KW", this is 128, 192, and 256, respectively.<a href="#section-2.3-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-3.5">cctag</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-3.6">
                            In Direct Key Agreement mode this is set to an empty octet string. In Key Agreement
                            with Key Wrapping mode, this is set to the raw octets of the JWE Authentication Tag.<a href="#section-2.3-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-3.7">AlgorithmID</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-3.8">
                            The AlgorithmID value is of the form Datalen || Data, where Data is a variable-length
                            string of zero or more octets, and Datalen is a fixed-length, big-endian 32-bit counter
                            that indicates the length (in octets) of Data. In the Direct Key Agreement case,
                            Data is set to the octets of the ASCII representation of the "enc" Header Parameter value.
                            In the Key Agreement with Key Wrapping case, Data is set to the octets of the ASCII
                            representation of the "alg" (algorithm) Header Parameter value.<a href="#section-2.3-3.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-3.9">PartyUInfo</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-3.10">
                          The PartyUInfo value is of the form Datalen || Data, where Data is
                          a variable-length string of zero or more octets, and Datalen is a
                          fixed-length, big-endian 32-bit counter that indicates the length
                          (in octets) of Data.  If an "apu" (agreement PartyUInfo) Header
                          Parameter is present, Data is set to the result of base64url
                          decoding the "apu" value and Datalen is set to the number of
                          octets in Data.  Otherwise, Datalen is set to 0 and Data is set to
                          the empty octet sequence.<a href="#section-2.3-3.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-3.11">PartyVInfo</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-3.12">
                          The PartyVInfo value is of the form Datalen || Data, where Data is
                          a variable-length string of zero or more octets, and Datalen is a
                          fixed-length, big-endian 32-bit counter that indicates the length
                          (in octets) of Data.  If an "apv" (agreement PartyVInfo) Header
                          Parameter is present, Data is set to the result of base64url
                          decoding the "apv" value and Datalen is set to the number of
                          octets in Data.  Otherwise, Datalen is set to 0 and Data is set to
                          the empty octet sequence.<a href="#section-2.3-3.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-3.13">SuppPubInfo</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-3.14">
                            This is set to the keydatalen represented as a 32-bit big-endian integer
                            followed by the octets of the cctag.<a href="#section-2.3-3.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.3-3.15">SuppPrivInfo</dt>
          <dd style="margin-left: 1.5em" id="section-2.3-3.16">
                            This is set to the empty octet sequence.<a href="#section-2.3-3.16" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.3-4">

                    Applications need to specify how the "apu" and "apv" Header Parameters are used for that
                    application. The "apu" and "apv" values MUST be distinct, when used. Applications wishing
                    to conform to <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span> need to provide values that meet the requirements
                    of that document, e.g., by using values that identify the producer and consumer.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.3-5">
                    See <a href="#example" class="xref">Appendix A</a> for an example key agreement computation using this method.<a href="#section-2.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="IANA">
<section id="section-3">
      <h2 id="name-iana-considerations-2">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-iana-considerations-2" class="section-name selfRef">IANA considerations</a>
      </h2>
<p id="section-3-1">
                This section registers identifiers under the IANA JSON Web Signature and Encryption Algorithms
                Registry established by <span>[<a href="#RFC7518" class="xref">RFC7518</a>]</span> and the IANA JSON Web Signature and Encryption
                Header Parameters registry established by <span>[<a href="#RFC7515" class="xref">RFC7515</a>]</span>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<section id="section-3.1">
        <h3 id="name-json-web-signature-and-encryp">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-json-web-signature-and-encryp" class="section-name selfRef">JSON Web Signature and Encryption Algorithms Registration</a>
        </h3>
<p id="section-3.1-1">
                    This section registers JWE algorithms as per the registry established in
                    <span>[<a href="#RFC7518" class="xref">RFC7518</a>]</span>.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<section id="section-3.1.1">
          <h4 id="name-ecdh-1pu-2">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-ecdh-1pu-2" class="section-name selfRef">ECDH-1PU</a>
          </h4>
<ul class="compact">
<li class="compact" id="section-3.1.1-1.1">Algorithm Name: "ECDH-1PU"<a href="#section-3.1.1-1.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.1.1-1.2">Algorithm Description: ECDH One-Pass Unified Model using one-pass KDF<a href="#section-3.1.1-1.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.1.1-1.3">Algorithm Usage Location(s): "alg"<a href="#section-3.1.1-1.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.1.1-1.4">JOSE Implementation Requirements: Optional<a href="#section-3.1.1-1.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.1.1-1.5">Change Controller: IESG<a href="#section-3.1.1-1.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.1.1-1.6">Specification Document(s): <a href="#ecdh-1pu" class="xref">Section 2</a><a href="#section-3.1.1-1.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.1.1-1.7">Algorithm Analysis Document(s): <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span> (Section 7.3), 
                                <span>[<a href="#PKAE" class="xref">PKAE</a>]</span><a href="#section-3.1.1-1.7" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</section>
<section id="section-3.2">
        <h3 id="name-json-web-signature-and-encrypt">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-json-web-signature-and-encrypt" class="section-name selfRef">JSON Web Signature and Encryption Header Parameters Registration</a>
        </h3>
<p id="section-3.2-1">
                    This section registers new Header Parameters as per the registry established in
                    <span>[<a href="#RFC7515" class="xref">RFC7515</a>]</span>.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<section id="section-3.2.1">
          <h4 id="name-skid-2">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-skid-2" class="section-name selfRef">skid</a>
          </h4>
<ul class="compact">
<li class="compact" id="section-3.2.1-1.1">Header Parameter Name: "skid"<a href="#section-3.2.1-1.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-1.2">Header Parameter Description: Sender Key ID<a href="#section-3.2.1-1.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-1.3">Header Parameter Usage Location(s): JWE<a href="#section-3.2.1-1.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-1.4">Change Controller: IESG<a href="#section-3.2.1-1.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.2.1-1.5">Specification Document(s): <a href="#skid" class="xref">Section 2.2.1</a><a href="#section-3.2.1-1.5" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</section>
</section>
</div>
<div id="security">
<section id="section-4">
      <h2 id="name-security-considerations-2">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-security-considerations-2" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-4-1">
                The security considerations of <span>[<a href="#RFC7516" class="xref">RFC7516</a>]</span> and <span>[<a href="#RFC7518" class="xref">RFC7518</a>]</span> 
                relevant to ECDH-ES also apply to this specification.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">The security considerations of <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span> apply here.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">
                When performing an ECDH key agreement between a static private key and any untrusted
                public key, care should be taken to ensure that the public key is a valid point on
                the same curve as the private key. Failure to do so may result in compromise of the
                static private key. For the NIST curves P-256, P-384, and P-521, appropriate validation
                routines are given in Section 5.6.2.3.3 of <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span>. For the curves
                used by X25519 and X448, consult the security considerations of <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">
                The ECDH-1PU algorithm is vulnerable to Key Compromise Impersonation (KCI) attacks. If
                the long-term static private key of a party is compromised, then the attacker can not
                only impersonate that party to other parties, but also impersonate any other party when
                communicating with the compromised party. If resistance to KCI is desired in a single 
                message, then the sender SHOULD use a nested JWS signature over the content.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">
                When Key Agreement with Key Wrapping is used, the JWE Authentication Tag is included in
                the input to the Key Derivation Function, as described in section <a href="#kdf" class="xref">Section 2.3</a>.
                Without this step, when the same Content Encryption Key (CEK) is reused for multiple
                recipients, then any of those recipients can produce a new message that appears to come
                from the original sender. If the MAC used by the content encryption algorithm is not
                compactly committing (<span>[<a href="#ccAEAD" class="xref">ccAEAD</a>]</span>) then it may be possible for a recipient
                to calculate an alternative message that produces the same authentication tag. An
                alternative is to encrypt the message separately to each recipient using Direct Key
                Agreement, or to sign the message using a nested signed-then-encrypted JOSE composition.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">
                The security properties of the one-pass unified model are given in Section 7.3 of
                <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span>.<a href="#section-4-6" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-5">
      <h2 id="name-references-2">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-references-2" class="section-name selfRef">References</a>
      </h2>
<section id="section-5.1">
        <h3 id="name-normative-references-2">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-normative-references-2" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="NIST.800-56A">[NIST.800-56A]</dt>
        <dd>
<span class="refAuthor">Barker, E.</span>, <span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Roginsky, A.</span>, <span class="refAuthor">Vassilev, A.</span>, and <span class="refAuthor">R. Davis</span>, <span class="refTitle">"Recommendation for Pair-Wise Key Establishment Using Discrete Logarithm Cryptography Revision 3."</span>, <span class="seriesInfo">NIST Special Publication 800-56A</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-56Ar3.pdf">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-56Ar3.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7515">[RFC7515]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Sakimura</span>, <span class="refTitle">"JSON Web Signature (JWS)"</span>, <span class="seriesInfo">RFC 7515</span>, <span class="seriesInfo">DOI 10.17487/RFC7515</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7515">https://www.rfc-editor.org/info/rfc7515</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7516">[RFC7516]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span> and <span class="refAuthor">J. Hildebrand</span>, <span class="refTitle">"JSON Web Encryption (JWE)"</span>, <span class="seriesInfo">RFC 7516</span>, <span class="seriesInfo">DOI 10.17487/RFC7516</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7516">https://www.rfc-editor.org/info/rfc7516</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7517">[RFC7517]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refTitle">"JSON Web Key (JWK)"</span>, <span class="seriesInfo">RFC 7517</span>, <span class="seriesInfo">DOI 10.17487/RFC7517</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7517">https://www.rfc-editor.org/info/rfc7517</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7518">[RFC7518]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refTitle">"JSON Web Algorithms (JWA)"</span>, <span class="seriesInfo">RFC 7518</span>, <span class="seriesInfo">DOI 10.17487/RFC7518</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7518">https://www.rfc-editor.org/info/rfc7518</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7748">[RFC7748]</dt>
        <dd>
<span class="refAuthor">Langley, A.</span>, <span class="refAuthor">Hamburg, M.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7748">https://www.rfc-editor.org/info/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-5.2">
        <h3 id="name-informative-references-2">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-informative-references-2" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="ccAEAD">[ccAEAD]</dt>
        <dd>
<span class="refAuthor">Grubbs, P.</span>, <span class="refAuthor">Lu, J.</span>, and <span class="refAuthor">T. Ristenpart</span>, <span class="refTitle">"Message Franking via Committing Authenticated Encryption"</span>, <span class="seriesInfo">IACR ePrint 2017/664</span>, <time datetime="2017" class="refDate">2017</time>, <span>&lt;<a href="https://eprint.iacr.org/2017/664.pdf">https://eprint.iacr.org/2017/664.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="MRES">[MRES]</dt>
        <dd>
<span class="refAuthor">Bellare, M.</span>, <span class="refAuthor">Boldyreva, A.</span>, <span class="refAuthor">Kurosawa, K.</span>, and <span class="refAuthor">J. Staddon</span>, <span class="refTitle">"Multi-Recipient Encryption Schemes: Efficient Constructions and their Security"</span>, <span class="seriesInfo">IEEE Transactions on Information Theory Vol. 53, Number 11</span>, <time datetime="2007" class="refDate">2007</time>, <span>&lt;<a href="https://www.cc.gatech.edu/~aboldyre/papers/bbks.pdf">https://www.cc.gatech.edu/~aboldyre/papers/bbks.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="PKAE">[PKAE]</dt>
      <dd>
<span class="refAuthor">An, J.</span>, <span class="refTitle">"Authenticated Encryption in the Public-Key Setting: Security Notions and Analyses"</span>, <span class="seriesInfo">IACR ePrint 2001/079</span>, <time datetime="2001" class="refDate">2001</time>, <span>&lt;<a href="https://eprint.iacr.org/2001/079.ps">https://eprint.iacr.org/2001/079.ps</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="example">
<section id="section-appendix.a">
      <h2 id="name-example-ecdh-1pu-key-agreeme">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-example-ecdh-1pu-key-agreeme" class="section-name selfRef">Example ECDH-1PU Key Agreement Computation with A256GCM</a>
      </h2>
<p id="section-appendix.a-1">
              This example uses ECDH-1PU in Direct Key Agreement mode ("alg" value "ECDH-1PU")
              to produce an agreed-upon key for AES GCM with a 256-bit key ("enc" value "A256GCM").
              The example re-uses the keys and parameters of the example computation in Appendix C
              of <span>[<a href="#RFC7518" class="xref">RFC7518</a>]</span>, with the addition of an extra static key-pair for Alice.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<p id="section-appendix.a-2">
              In this example, a producer Alice is encrypting content to a consumer Bob. Alice's
              static key-pair (in JWK format) used for the key agreement in this example (including
              the private part) is:<a href="#section-appendix.a-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.a-3">
<pre>
      {"kty":"EC",
       "crv":"P-256",
       "x":"WKn-ZIGevcwGIyyrzFoZNBdaq9_TsqzGl96oc0CWuis",
       "y":"y77t-RvAHRKTsSGdIYUfweuOvwrvDD-Q3Hv5J0fSKbE",
       "d":"Hndv7ZZjs_ke8o9zXYo3iq-Yr8SewI5vrqd0pAvEPqg"}
</pre><a href="#section-appendix.a-3" class="pilcrow">¶</a>
</div>
<p id="section-appendix.a-4">
              Bob's static key-pair (in JWK format) is:<a href="#section-appendix.a-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.a-5">
<pre>
      {"kty":"EC",
       "crv":"P-256",
       "x":"weNJy2HscCSM6AEDTDg04biOvhFhyyWvOHQfeF_PxMQ",
       "y":"e8lnCO-AlStT-NJVX-crhB7QRYhiix03illJOVAOyck",
       "d":"VEmDZpDXXK8p8N0Cndsxs924q6nS1RXFASRl6BfUqdw"}
</pre><a href="#section-appendix.a-5" class="pilcrow">¶</a>
</div>
<p id="section-appendix.a-6">
              The producer (Alice) generates an ephemeral key for the key agreement computation.
              Alice's ephemeral key (in JWK format) is:<a href="#section-appendix.a-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.a-7">
<pre>
      {"kty":"EC",
       "crv":"P-256",
       "x":"gI0GAILBdu7T53akrFmMyGcsF3n5dO7MmwNBHKW5SV0",
       "y":"SLW_xSffzlPWrHEVI30DHM_4egVwt3NQqeUD7nMFpps",
       "d":"0_NxaRPUMQoAJt50Gz8YiTr8gRTwyEaCumd-MToTmIo"}
</pre><a href="#section-appendix.a-7" class="pilcrow">¶</a>
</div>
<p id="section-appendix.a-8">
           Header Parameter values used in this example are as follows.  The
           "apu" (agreement PartyUInfo) Header Parameter value is the base64url
           encoding of the UTF-8 string "Alice" and the "apv" (agreement
           PartyVInfo) Header Parameter value is the base64url encoding of the
           UTF-8 string "Bob".  The "epk" (ephemeral public key) Header
           Parameter is used to communicate the producer's (Alice's) ephemeral
           public key value to the consumer (Bob).<a href="#section-appendix.a-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.a-9">
<pre>
     {"alg":"ECDH-1PU",
      "enc":"A256GCM",
      "apu":"QWxpY2U",
      "apv":"Qm9i",
      "epk":
       {"kty":"EC",
        "crv":"P-256",
        "x":"gI0GAILBdu7T53akrFmMyGcsF3n5dO7MmwNBHKW5SV0",
        "y":"SLW_xSffzlPWrHEVI30DHM_4egVwt3NQqeUD7nMFpps"
       }
     }
</pre><a href="#section-appendix.a-9" class="pilcrow">¶</a>
</div>
<p id="section-appendix.a-10">
              The resulting one-pass KDF <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span> parameter values are:<a href="#section-appendix.a-10" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel dlCompact" id="section-appendix.a-11">
        <dt id="section-appendix.a-11.1">Ze</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.a-11.2">
                      This is set to the output of the ECDH key agreement between Alice's
                      ephemeral private key and Bob's static public key. In this example,
                      Ze is the following octet sequence (in hexadecimal notation):<a href="#section-appendix.a-11.2" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<div class="artwork art-text alignLeft" id="section-appendix.a-12">
<pre>
      9e 56 d9 1d 81 71 35 d3 72 83 42 83 bf 84 26 9c
      fb 31 6e a3 da 80 6a 48 f6 da a7 79 8c fe 90 c4</pre><a href="#section-appendix.a-12" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel dlCompact" id="section-appendix.a-13">
        <dt id="section-appendix.a-13.1">Zs</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.a-13.2">
                      This is set to the output of the ECDH key agreement between Alice's
                      static private key and Bob's static public key. In this example,
                      Zs is the following octet sequence (in hexadecimal notation):<a href="#section-appendix.a-13.2" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<div class="artwork art-text alignLeft" id="section-appendix.a-14">
<pre>
      e3 ca 34 74 38 4c 9f 62 b3 0b fd 4c 68 8b 3e 7d
      41 10 a1 b4 ba dc 3c c5 4e f7 b8 12 41 ef d5 0d</pre><a href="#section-appendix.a-14" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel dlCompact" id="section-appendix.a-15">
        <dt id="section-appendix.a-15.1">Z</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.a-15.2">
                      This is set to the concatenation of Ze followed by Zs. In this example,
                      Z is the following octet sequence (in hexadecimal notation):<a href="#section-appendix.a-15.2" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<div class="artwork art-text alignLeft" id="section-appendix.a-16">
<pre>
      9e 56 d9 1d 81 71 35 d3 72 83 42 83 bf 84 26 9c
      fb 31 6e a3 da 80 6a 48 f6 da a7 79 8c fe 90 c4
      e3 ca 34 74 38 4c 9f 62 b3 0b fd 4c 68 8b 3e 7d
      41 10 a1 b4 ba dc 3c c5 4e f7 b8 12 41 ef d5 0d</pre><a href="#section-appendix.a-16" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel dlCompact" id="section-appendix.a-17">
        <dt id="section-appendix.a-17.1">keydatalen</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.a-17.2">
                      This value is 256 - the number of bits in the desired output key
                      (because "A256GCM" uses a 256-bit key).<a href="#section-appendix.a-17.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-appendix.a-17.3">AlgorithmID</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.a-17.4">
                      This is set to the octets representing the 32-bit big-endian value
                      7 - 00 00 00 07 in hexadecimal notation - the number of octets in
                      the AlgorithmID content "A256GCM", followed by the octets representing
                      the ASCII string "A256GCM" - 41 32 35 36 47 43 4d (in hex). The
                      complete value is therefore: 00 00 00 07 41 32 35 36 47 43 4d<a href="#section-appendix.a-17.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-appendix.a-17.5">PartyUInfo</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.a-17.6">
                      This is set to the octets representing the 32-bit big-endian value
                      5, followed by the octets representing the UTF-8 string "Alice". In
                      hexadecimal notation: 00 00 00 05 41 6c 69 63 65<a href="#section-appendix.a-17.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-appendix.a-17.7">PartyVInfo</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.a-17.8">
                      This is set to the octets representing the 32-bit big-endian value
                      3, followed by the octets representing the UTF-8 string "Bob". In
                      hexadecimal notation: 00 00 00 03 42 6f 62<a href="#section-appendix.a-17.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-appendix.a-17.9">SuppPubInfo</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.a-17.10">
                      This is set to the octets representing the 32-bit big-endian value
                      256 - the keydatalen value. In hexadecimal notation: 00 00 01 00<a href="#section-appendix.a-17.10" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-appendix.a-17.11">SuppPrivInfo</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.a-17.12">
                      This is set to the empty octet sequence.<a href="#section-appendix.a-17.12" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-appendix.a-18">
              Concatenating the parameters AlgorithmID through SuppPrivInfo results in a FixedInfo
              value in Concatenation Format (as per Section 5.8.2.1.1 of <span>[<a href="#NIST.800-56A" class="xref">NIST.800-56A</a>]</span>)
              of (in hexidecimal notation):<a href="#section-appendix.a-18" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.a-19">
<pre>
      00 00 00 07 41 32 35 36 47 43 4d 00 00 00 05 41
      6c 69 63 65 00 00 00 03 42 6f 62 00 00 01 00
</pre><a href="#section-appendix.a-19" class="pilcrow">¶</a>
</div>
<p id="section-appendix.a-20">
              Concatenating the round number 1 (00 00 00 01), Z, and the FixedInfo value results in
              a one-pass KDF round 1 hash input of (hexadecimal):<a href="#section-appendix.a-20" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.a-21">
<pre>
      00 00 00 01 9e 56 d9 1d 81 71 35 d3 72 83 42 83
      bf 84 26 9c fb 31 6e a3 da 80 6a 48 f6 da a7 79
      8c fe 90 c4 e3 ca 34 74 38 4c 9f 62 b3 0b fd 4c
      68 8b 3e 7d 41 10 a1 b4 ba dc 3c c5 4e f7 b8 12
      41 ef d5 0d 00 00 00 07 41 32 35 36 47 43 4d 00
      00 00 05 41 6c 69 63 65 00 00 00 03 42 6f 62 00
      00 01 00</pre><a href="#section-appendix.a-21" class="pilcrow">¶</a>
</div>
<p id="section-appendix.a-22">
              The resulting derived key, which is the full 256 bits of the round 1 hash output is:<a href="#section-appendix.a-22" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.a-23">
<pre>
      6c af 13 72 3d 14 85 0a d4 b4 2c d6 dd e9 35 bf
      fd 2f ff 00 a9 ba 70 de 05 c2 03 a5 e1 72 2c a7
</pre><a href="#section-appendix.a-23" class="pilcrow">¶</a>
</div>
<p id="section-appendix.a-24">
              The base64url-encoded representation of this derived key is:<a href="#section-appendix.a-24" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-appendix.a-25">
<pre>
      bK8Tcj0UhQrUtCzW3ek1v_0v_wCpunDeBcIDpeFyLKc
</pre><a href="#section-appendix.a-25" class="pilcrow">¶</a>
</div>
</section>
</div>
<section id="section-appendix.b">
      <h2 id="name-document-history-2">
<a href="#section-appendix.b" class="section-number selfRef">Appendix B. </a><a href="#name-document-history-2" class="section-name selfRef">Document History</a>
      </h2>
<span class="break"></span><dl class="dlParallel dlCompact" id="section-appendix.b-1">
        <dt id="section-appendix.b-1.1">-03</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.b-1.2">
                      Corrected typos and clarified wording. Removed unnecessary references.<a href="#section-appendix.b-1.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-appendix.b-1.3">-02</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.b-1.4">
                      Removed two-way interactive handshake protocol section and example after
                      discussion with Hannes Tschofenig.<a href="#section-appendix.b-1.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-appendix.b-1.5">-01</dt>
        <dd style="margin-left: 1.5em" id="section-appendix.b-1.6">
                      Added examples in <a href="#example" class="xref">Appendix A</a> and a two-way handshake example.
                      Added "skid" Header Parameter and registration. Fleshed out Security Considerations.<a href="#section-appendix.b-1.6" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
<div id="authors-addresses">
<section id="section-appendix.c">
      <h2 id="name-authors-address-2">
<a href="#name-authors-address-2" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Neil Madden</span></div>
<div dir="auto" class="left"><span class="org">ForgeRock</span></div>
<div dir="auto" class="left"><span class="street-address">Broad Quay House<br>Prince Street</span></div>
<div dir="auto" class="left"><span class="locality">Bristol</span></div>
<div dir="auto" class="left"><span class="postal-code">BS1 4DJ</span></div>
<div dir="auto" class="left"><span class="country-name">United Kingdom</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:neil.madden@forgerock.com" class="email">neil.madden@forgerock.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
